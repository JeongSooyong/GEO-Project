<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nike.geo.model.CommDaoImpl">

	<!-- division 별 공통 테이블 가져오기 -->
	<!-- REF NULL 아닌 경우만 가능 -->
	<select id="commSelect" resultType="CommonVo">
		SELECT COMMON_CODE ,CODE_NAME ,DIVISION ,
			REG_ID ,REG_DATE ,MOD_ID ,MOD_DATE,REF 
	 FROM COM c 
	 WHERE DIVISION = #{division}
	</select>

	<!-- 로그인 selectEmp -->
	<select id="selectEmp" resultType="EmpVo">
		SELECT EMP_NO, EMP_POS, EMP_DEPT,
				EMP_PW, EMP_NAME, EMP_GENDER,
				EMP_HIREDATE, EMP_EMAIL, EMP_PHONE,
				EMP_BIRTH, EMP_POSTCODE, EMP_ADDRESS1,
				EMP_ADDRESS2, EMP_ADDRESS3, EMP_AUTH,
				EMP_STATUS, EMP_RETIREDATE, REG_ID,
				REG_DATE, MOD_ID, MOD_DATE
			FROM GEO.EMP
			WHERE EMP_NO = #{emp_no} AND EMP_PW = #{emp_pw}
	</select>
	
	<!-- 임시비밀번호 발급 전 정보 확인 selectEmpTemp -->
	<select id="selectEmpTemp" resultType="EmpVo">
		SELECT EMP_NO, EMP_POS, EMP_DEPT,
				EMP_PW, EMP_NAME, EMP_GENDER,
				EMP_HIREDATE, EMP_EMAIL, EMP_PHONE,
				EMP_BIRTH, EMP_POSTCODE, EMP_ADDRESS1,
				EMP_ADDRESS2, EMP_ADDRESS3, EMP_AUTH,
				EMP_STATUS, EMP_RETIREDATE, REG_ID,
				REG_DATE, MOD_ID, MOD_DATE
			FROM GEO.EMP
			WHERE EMP_NO = #{emp_no}
				AND EMP_NAME = #{emp_name}
				AND EMP_EMAIL = #{emp_email}
	</select>
	
	<!-- 임시비밀번호 발급 updateTempPw -->
	<update id="updateTempPw">
		UPDATE GEO.EMP
			SET EMP_PW=#{emp_pw}, EMP_STATUS='W',  MOD_ID='ADMIN', MOD_DATE=SYSDATE
			WHERE EMP_NO=#{emp_no}
	</update>
	
	
	<select id="findFile" resultType="FileVo">
		SELECT FILE_NO, ORIGIN_NO, FILE_ONAME,
				FILE_SNAME, FILE_SIZE, FILE_TYPE,
				FILE_RANK, FILE_DEL_YN, REG_ID,
				REG_DATE, MOD_ID, MOD_DATE
			FROM GEO."FILE"
			WHERE FILE_NO = #{file_no}
	</select>
	
	<!-- 메인화면 사원정보 조회 selectMainEmp -->
	<select id="selectMainEmp" resultType="EmpVo">
		 SELECT EMP_NO ,
		 		EMP.EMP_NAME AS EMP_NAME,
			    POS.CODE_NAME AS EMP_POS,
			    DEPT.CODE_NAME AS EMP_DEPT
			FROM EMP INNER JOIN COM POS 
				ON EMP.EMP_POS = POS.COMMON_CODE
					AND POS.DIVISION = '직급'
			INNER JOIN COM DEPT
				ON EMP.EMP_DEPT = DEPT.COMMON_CODE
					AND DEPT.DIVISION = '부서'
			WHERE EMP.EMP_NO = #{emp_no}
	</select>
	
	<!-- 메인화면 게시판 조회 selectMainBoard  -->
	<select id="selectMainBoard" resultType="BoardVo">
		SELECT BO_NO , EMP_NO , BO_TITLE ,
				BO_CONTENT , BO_VIEW_COUNT , BO_REGDATE
			FROM (SELECT *
					FROM BO
					WHERE BO_STATUS = #{bo_status}
						AND BO_DEL_YN = 'N'
					ORDER BY BO_REGDATE DESC)
			<![CDATA[WHERE ROWNUM <= 5]]>
	</select>
</mapper>
