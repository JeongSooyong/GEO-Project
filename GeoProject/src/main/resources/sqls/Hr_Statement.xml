<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- namespace : impl패키지 경로로 통일 -->
<mapper namespace="com.nike.geo.model.EmpDaoImpl">

<!-- 사원 추가 -->
<insert id="insertEmp">

INSERT INTO GEO.EMP
	(EMP_NO, EMP_POS, EMP_DEPT, EMP_PW, 
	EMP_NAME, EMP_GENDER, EMP_HIREDATE, EMP_EMAIL, 
	EMP_PHONE, EMP_BIRTH, EMP_ADDRESS, EMP_AUTH, 
	EMP_STATUS, EMP_RETIREDATE, REG_ID, REG_DATE, 
	MOD_ID, MOD_DATE)
VALUES(#{emp_no}, #{emp_pos}, #{emp_dept}, #{emp_pw}, 
	#{emp_name}, #{emp_gender}, TO_CHAR(SYSDATE, 'yyyy-MM-dd'), #{emp_email}, 
	#{emp_phone}, #{emp_birth, jdbcType=DATE}, #{emp_address}, 'AU003', 
	'ST001', '', '관리자', TO_CHAR(SYSDATE, 'yyyy-MM-dd'), 
	'관리자', TO_CHAR(SYSDATE, 'yyyy-MM-dd'))
</insert>

<!-- 사원 전체 조회 -->
<select id="selectAll" resultType="EmpVo">
SELECT EMP_NO , <!-- (SELECT CODE_NAME FROM COM WHERE DIVISION = '직급')  , (SELECT CODE_NAME FROM COM WHERE DIVISION = '부서') , -->
	EMP_POS , EMP_DEPT ,
	EMP_NAME , EMP_GENDER , EMP_HIREDATE , 
	EMP_EMAIL , EMP_PHONE , EMP_BIRTH , EMP_ADDRESS
FROM EMP e
</select>

<!-- 사원 상세 조회 -->
<select id="selectOneEmp" resultType="EmpVo">
SELECT EMP_NO , EMP_NAME , EMP_DEPT , EMP_POS , 
EMP_GENDER , EMP_BIRTH , EMP_PHONE , 
EMP_EMAIL , EMP_ADDRESS , EMP_HIREDATE 
	FROM EMP e 
	WHERE EMP_NO = #{emp_no}
</select>




<!-- 사원 정보 변경 -->
<update id="updateEmp" parameterType="EmpVo">
UPDATE GEO.EMP
SET emp_pos = #{emp_pos}, 
	emp_dept = #{emp_dept}, 
	emp_email = #{emp_email}, 
	emp_phone = #{emp_phone}, 
	emp_address = #{emp_address}
WHERE emp_no = #{emp_no}
</update>

<!-- 비밀번호 초기화 -->
<update id="clearPw" parameterType="EmpVo">
UPDATE GEO.EMP
SET emp_pw = '1234',
	emp_status = 'W'
WHERE emp_no = #{emp_no}
</update>

<!-- 출근 -->
<insert id="arriveWork">
INSERT INTO GEO.ATT
(EMP_NO, ATT_ARRIVE_TIME, ATT_LEFT_TIME, REG_ID, REG_DATE, MOD_ID, MOD_DATE)
SELECT e.EMP_NO, SYSDATE, '', e.EMP_NO, TO_CHAR(SYSDATE, 'yyyy-MM-dd'),
e.EMP_NO, TO_CHAR(SYSDATE, 'yyyy-MM-dd')
FROM EMP e
LEFT JOIN ATT a ON e.EMP_NO = a.EMP_NO
WHERE e.EMP_NO = #{emp_no, jdbcType=VARCHAR}
</insert>

<!-- 퇴근 -->
<update id="leftWork">
UPDATE GEO.ATT
SET ATT_LEFT_TIME = SYSDATE,
	MOD_ID = EMP_NO,
	MOD_DATE = SYSDATE
WHERE EMP_NO = #{emp_no, jdbcType=VARCHAR}
AND ATT_LEFT_TIME IS NULL
AND TO_CHAR(ATT_ARRIVE_TIME, 'yyyy-MM-dd') = TO_CHAR(SYSDATE, 'yyyy-MM-dd')
</update>

<!-- 마이페이지 -->
<select id="myPage">
SELECT EMP_NO , EMP_POS , EMP_DEPT , EMP_NAME ,
EMP_GENDER , EMP_HIREDATE , EMP_EMAIL , EMP_PHONE ,
EMP_BIRTH , EMP_ADDRESS
	FROM EMP e
	WHERE EMP_NO = #{emp_no}
</select>

<!-- 사원 근태 조회 -->
<select id="empAtt" resultType="AttVo">
SELECT EMP_NO , ATT_ARRIVE_TIME , ATT_LEFT_TIME
	FROM ATT a 
	WHERE EMP_NO = #{emp_no, jdbcType=VARCHAR}
</select>


</mapper>
